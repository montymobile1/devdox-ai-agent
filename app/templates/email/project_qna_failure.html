<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ project.name }} – Q&A Failed</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="color-scheme" content="light dark">
  <meta name="supported-color-schemes" content="light dark">
  <style>
    /* ===== Base (email-safe) ===== */
    html, body { margin:0; padding:0; height:100%; }
    body { width:100% !important; background:#f4f6fb; color:#111827; -webkit-text-size-adjust:100%; -ms-text-size-adjust:100%; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    a { color:#0ea5e9; text-decoration:none; }
    img { border:0; outline:none; text-decoration:none; max-width:100%; height:auto; display:block; }
    table { border-collapse:collapse !important; }
    .preheader { display:none!important; visibility:hidden; opacity:0; color:transparent; height:0; width:0; overflow:hidden; mso-hide:all; }

    /* ===== Layout ===== */
    .outer { width:100%; background:#eef2f7; }
    .p-24 { padding:24px; }
    .container { width:100%; max-width:720px; margin:0 auto; background:#ffffff; border-radius:14px; box-shadow:0 6px 24px rgba(16,24,40,0.06); overflow:hidden; }
    .section { padding:22px 24px 8px 24px; }

    /* ===== Content ===== */
    .card { border:1px solid #e5e7eb; border-radius:12px; padding:16px; background:#ffffff; }
    .card-danger { background:#fff5f5; border-color:#fecaca; }
    .badge { display:inline-block; padding:3px 8px; font-size:12px; border-radius:999px; font-weight:600; vertical-align:middle; }
    .badge-danger { color:#991b1b; background:#fee2e2; border:1px solid #fecaca; }
    .lead { margin:10px 0 8px 0; font-size:16px; line-height:1.5; font-weight:600; color:#111827; }
    .err {
      margin:8px 0 0 0;
      color:#991b1b;
      font-size:14px;
      line-height:1.6;
      word-wrap:break-word;
      white-space:pre-line; /* keep newlines */
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background:#fff;
      border-left:3px solid #fca5a5;
      padding:10px 12px;
      border-radius:8px;
    }
    .meta { color:#6b7280; font-size:13px; margin-top:8px; }

    /* ===== Button (bulletproof) ===== */
    .btn-wrap { margin-top:14px; }
    .btn {
      display:inline-block;
      background:#0ea5e9;
      color:#ffffff !important;
      text-decoration:none;
      padding:12px 18px;
      border-radius:10px;
      font-weight:700;
      line-height:1;
    }

    /* ===== Footer ===== */
    .footer { padding:18px 24px; color:#6b7280; font-size:12px; background:#f9fafb; }

    /* ===== Mobile tweaks ===== */
    @media screen and (max-width: 600px) {
      .p-24 { padding:16px !important; }
      .section { padding:18px 16px 6px 16px !important; }
    }

    /* ===== Dark Mode ===== */
    @media (prefers-color-scheme: dark) {
      body { background:#0b1220; color:#e5e7eb; }
      .outer { background:#0b1220; }
      .container { background:#0f172a; box-shadow:none; }
      .card { background:#0f172a; border-color:#1f2937; }
      .card-danger { background:#1f2937; border-color:#374151; }
      .badge-danger { color:#fecaca; background:#2b2f36; border-color:#3b4048; }
      .err { color:#fecaca; background:#0f172a; border-left-color:#fca5a5; }
      .footer { background:#0b1220; color:#94a3b8; }
      a { color:#38bdf8; }
      .btn { background:#0284c7 !important; }
    }
  </style>
  <!--[if mso]>
    <style>
      .btn { font-family: Arial, sans-serif !important; }
    </style>
  <![endif]-->
</head>
<body>
  <!-- Inbox preview line -->
  <span class="preheader">Q&amp;A generation failed for {{ project.name }}.</span>

  <!-- Wrapper -->
  <table role="presentation" class="outer" width="100%" cellspacing="0" cellpadding="0">
    <tr>
      <td class="p-24" align="center">
        <table role="presentation" class="container" width="100%" cellspacing="0" cellpadding="0">
          <!-- ===== Header with bulletproof blue background ===== -->
          <tr>
            <td bgcolor="#0ea5e9" style="padding:0;">
              <!--[if gte mso 9]>
              <v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false"
                      style="width:100%; mso-width-percent:1000; height:auto; mso-fit-shape-to-text:true;">
                <v:fill type="gradient" color="#0284c7" color2="#0ea5e9" angle="90"/>
                <v:textbox inset="0,0,0,0">
              <![endif]-->
              <div style="background:#0ea5e9; background-image:linear-gradient(90deg,#0284c7,#0ea5e9); padding:18px 24px; color:#ffffff;">
                <div style="font-size:12px; letter-spacing:.08em; text-transform:uppercase; opacity:.9; margin:0 0 6px 0;">
                  DevDox • Q&amp;A
                </div>
                <h1 style="margin:0 0 6px 0; font-size:20px; line-height:1.35; font-weight:700;">
                  Generation failed
                </h1>
                <p style="margin:0; font-size:14px; opacity:.95;">
                  Project: <strong>{{ project.name }}</strong>
                  {% if project.repo_url %}<br>
                  <span style="opacity:.9;">Repository:</span>
                  <a href="{{ project.repo_url }}" style="color:#ffffff; text-decoration:underline; word-break:break-all;">
                    {{ project.repo_url }}
                  </a>
                  {% endif %}
                </p>
              </div>
              <!--[if gte mso 9]></v:textbox></v:rect><![endif]-->
            </td>
          </tr>

          <!-- ===== Notice / Error card ===== -->
          <tr>
            <td class="section">
              <div class="card card-danger" role="group" aria-labelledby="error-title">
                <span class="badge badge-danger" aria-hidden="true">Failed</span>
                <div id="error-title" class="lead">We couldn’t generate the Q&amp;A.</div>

                {% if error_message %}
                  <div class="err">{{ error_message }}</div>
                {% endif %}

                {% if project.repo_url %}
                  <div class="btn-wrap">
                    <!-- Bulletproof button via table for older clients -->
                    <table role="presentation" cellspacing="0" cellpadding="0">
                      <tr>
                        <td align="left">
                          <a class="btn" href="{{ project.repo_url }}">Open Repository</a>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <!-- Plain URL fallback -->
                  <p class="meta">
                    If the button doesn’t work, copy and paste this into your browser:<br>
                    <span style="word-break:break-all;">{{ project.repo_url }}</span>
                  </p>
                {% endif %}
              </div>
            </td>
          </tr>

          <!-- ===== Footer ===== -->
          <tr>
            <td class="footer">
              Sent by DevDox · Q&amp;A run failed.
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
